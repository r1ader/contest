<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <title>Matrix</title>
    <script type="text/javascript">

        document.addEventListener('plusready', function(){
            //console.log("所有plus api都应该在此事件发生后调用，否则会出现plus is undefined。"

        });

    </script>
    <script>
        var out = [1, 0, 0, 0, 1, 0, 0, 0, 1];
        function Fu_zhi() {
            var data_input = document.getElementsByClassName('form-control');
            var data_display2 = document.getElementsByClassName('input');
//            alert(data_display.length);
            for (var i = 0; i < data_display2.length; i++) {
                data_display2[i].innerText = data_input[i].value;
            }
        }
        /**/
        function Reverse() {
            var xs = document.getElementById('xsfs');
            xs.innerText = "显示分数";
            var data_output = document.getElementsByClassName('output');
            var data_output2 = document.getElementsByClassName('output2');
            var data_display = document.getElementsByClassName('input');
            var dt = new Array;//
            out = [1, 0, 0, 0, 1, 0, 0, 0, 1];
            var temp;
            var i;
            for (i = 0; i < data_display.length; i++) {
                dt[i] = data_display[i].innerText;
            }
            var det = dt[0] * dt[4] * dt[8] + dt[6] * dt[1] * dt[5] + dt[2] * dt[3] * dt[7] - dt[0] * dt[5] * dt[7] - dt[1] * dt[3] * dt[8] - dt[2] * dt[4] * dt[6];
////            alert(det);
            if (det == 0) {
                alert("这是一个不可逆矩阵");
                return
            }
//
            if (dt[0] == 0) {
                if (dt[3] != 0) {
                    for (i = 0; i <= 2; i++) {
                        temp = dt[i];
                        dt[i] = dt[i + 3];
                        dt[i + 3] = temp;
                        temp = out[i];
                        out[i] = out[i + 3];
                        out[i + 3] = temp;
                    }
                }
                else {
                    for (i = 0; i <= 2; i++) {
                        temp = dt[i];
                        dt[i] = dt[i + 3];
                        dt[i + 3] = temp;
                        temp = out[i];
                        out[i] = out[i + 3];
                        out[i + 3] = temp;
                    }
                }
            }
            //1行1列 自除
            temp = dt[0];
            for (i = 0; i <= 2; i++) {
                dt[i] /= temp;
                out[i] /= temp;
            }
            //消去第二行第一列
            temp = dt[3] / dt[0];
            for (i = 3; i <= 5; i++) {
                dt[i] -= dt[i - 3] * temp;
                out[i] -= out[i - 3] * temp;
            }
            //消去第三行第一列
            temp = dt[6] / dt[0];
            for (i = 6; i <= 8; i++) {
                dt[i] -= dt[i - 6] * temp;
                out[i] -= out[i - 6] * temp;
            }
            //若二行二列为0，与第三行交换
            if (dt[4] == 0) {
                for (i = 3; i <= 5; i++) {
                    temp = dt[i];
                    dt[i] = dt[i + 3];
                    dt[i + 3] = temp;
                    temp = out[i];
                    out[i] = out[i + 3];
                    out[i + 3] = temp;
                }
            }
            //2行2列 自除
            temp = dt[4];
            for (i = 3; i <= 5; i++) {
                dt[i] /= temp;
                out[i] /= temp;
            }
            //消去第三行第二列
            temp = dt[7] / dt[4];
            for (i = 6; i <= 8; i++) {
                dt[i] -= dt[i - 3] * temp;
                out[i] -= out[i - 3] * temp;
            }
            //3行3列 自除
            temp = dt[8];
            for (i = 6; i <= 8; i++) {
                dt[i] /= temp;
                out[i] /= temp;
            }
            //回消二行三列
            temp = dt[5];
            for (i = 3; i <= 5; i++) {
                dt[i] -= temp * dt[i + 3];
                out[i] -= temp * out[i + 3];
            }
            //回消一行三列
            temp = dt[2];
            for (i = 0; i <= 2; i++) {
                dt[i] -= temp * dt[i + 6];
                out[i] -= temp * out[i + 6];
            }
            //回消一行二列
            temp = dt[1];
            for (i = 0; i <= 2; i++) {
                dt[i] -= temp * dt[i + 3];
                out[i] -= temp * out[i + 3];
            }
            //结束，输出
            for (i = 0; i < data_display.length; i++) {
                data_output[i].innerText = dt[i];
                if(out[i]%1!=0)
                    data_output2[i].innerText = out[i].toFixed(2);
                else
                    data_output2[i].innerText = out[i];
            }
        }

        function get_fen(a) {
            if(a%1==0)
            {
                return a;
            }
            else
            {
                for(var mu=2;mu<=10000;mu++)
                {
                    if(Math.abs((a*mu)%1)<=0.000001||Math.abs((a*mu)%1+1)<=0.000001||Math.abs(1-(a*mu)%1)<=0.000001)
                    {
                        if(Math.abs(Math.floor(a*mu)-a*mu)<=0.000001)
                            return Math.floor(a*mu)+'/'+mu;
                        else if(Math.abs(Math.ceil(a*mu)-a*mu)<=0.000001)
                            return Math.ceil(a*mu)+'/'+mu;
                    }
                }
            }
            return 'fail';
        }

        function fen(bt) {
            var data_output2 = document.getElementsByClassName('output2');
            if(bt.innerText=="显示分数"){
                bt.innerText = "显示小数";
                for(var i=0;i<9;i++)
                {
                    data_output2[i].innerText = get_fen(out[i]);
                }
            }
            else
            {
                bt.innerText = "显示分数";
                for (i = 0; i < 9; i++) {
                    if(out[i]%1!=0)
                        data_output2[i].innerText = out[i].toFixed(2);
                    else
                        data_output2[i].innerText = out[i];
                }
            }
        }
    </script>
    <style>
        .matrix {
            /*align-content: center;*/
            display: inline-block;
            /*border-radius: 10px;*/
            /*background-color: #2aabd2;*/
        }

        .matrix td {
            font-weight: bold;
            font-size: 15px;
            padding: 6px;
            /*padding-left: 10px;*/
            /*padding-right: 10px;*/
        }

        .matrix img {
            height: 90px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row" style="height: 50px;" align="center">
        <div class="col-sm-5">
            <div class="panel panel-default" style="display:inline-block;">
                <div class="panel-heading">
                    <h2 class="panel-title">原矩阵</h2>
                </div>
                <div class="panel-body">
                    <table class="matrix" border="0" style="" data-toggle="modal" data-target="#myModal">
                        <tr align="center">
                            <td rowspan="3">
                                <img src="img/mleft.png">
                            </td>
                            <td class="input">1</td>
                            <td class="input">0</td>
                            <td class="input">0</td>
                            <td rowspan="3">
                                <img src="img/mright.png">
                            </td>
                        </tr>
                        <tr align="center">
                            <td class="input">0</td>
                            <td class="input">1</td>
                            <td class="input">0</td>
                        </tr>
                        <tr align="center">
                            <td class="input">0</td>
                            <td class="input">0</td>
                            <td class="input">1</td>
                        </tr>
                    </table>
                </div>
                <div class="panel-footer">
                    p.s 点击矩阵输入数据
                </div>
            </div>
        </div>


        <div class="col-sm-1" style="padding-bottom: 20px">
            <button class="btn btn-default" onclick="Reverse()">求逆</button>
            <button class="btn btn-default" onclick="fen(this)" id="xsfs">显示分数</button>
        </div>


        <div class="col-sm-5">
            <div class="panel panel-default" style="display:inline-block;">
                <div class="panel-heading">
                    <h2 class="panel-title">逆矩阵</h2>
                </div>
                <div class="panel-body">
                    <table class="matrix" style="display: none">
                        <tr align="center">
                            <td rowspan="3">
                                <img src="img/mleft.png">
                            </td>
                            <td class="output">1</td>
                            <td class="output">2</td>
                            <td class="output">3</td>
                            <td rowspan="3">
                                <img src="img/mright.png">
                            </td>
                        </tr>
                        <tr align="center">
                            <td class="output">3</td>
                            <td class="output">4</td>
                            <td class="output">5</td>
                        </tr>
                        <tr align="center">
                            <td class="output">5</td>
                            <td class="output">6</td>
                            <td class="output">7</td>
                        </tr>
                    </table>
                    <table class="matrix">
                        <tr align="center">
                            <td rowspan="3">
                                <img src="img/mleft.png">
                            </td>
                            <td class="output2">1</td>
                            <td class="output2">0</td>
                            <td class="output2">0</td>
                            <td rowspan="3">
                                <img src="img/mright.png">
                            </td>
                        </tr>
                        <tr align="center">
                            <td class="output2">0</td>
                            <td class="output2">1</td>
                            <td class="output2">0</td>
                        </tr>
                        <tr align="center">
                            <td class="output2">0</td>
                            <td class="output2">0</td>
                            <td class="output2">1</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    输入初始矩阵
                </h4>
            </div>
            <div class="modal-body">
                <form>
                    <table>
                        <tr>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                        </tr>
                        <tr>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                        </tr>
                        <tr>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                            <td><input type="tel" placeholder="0" class="form-control" value="0"
                                       onfocus="if (value =='0'){value =''}" onblur="if (value ==''){value='0'}"></td>
                        </tr>
                    </table>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary" onclick="Fu_zhi()" data-dismiss="modal">
                    保存
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
</body>
</html>